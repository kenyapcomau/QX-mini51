/ ************************************************* ********************************
* [Writing time]: March 5, 2014
* [Author]: Qingxiang Electronics: 03
* [Edition]: 1.0
* [Website]: http://www.qxmcu.com/
* [Taobao Store]: http://qxmcu.taobao.com/ (Direct Store) http://qx-mcu.taobao.com/ (Head Office)
* [Experimental platform]: QX-MCS51 microcontroller development board
* [External crystal oscillator]: 11.0592mhz
* [Main control chip]: STC89C52RC
* [Compilation Environment]: Keil μVisio4
* [Program function]: 12864 LCD display test
* [Instructions]: Unplug the digital tube J6 jumper cap before using LCD
The 12864 screen plugs out to the board and plugs into the L1 row female
************************************************** ******************************** /

#include <reg52.h>
#include <string.h>

#define uchar unsigned char
#define uint unsigned int

uchar code IC_DAT [];
uchar code pic1 [];
uchar code pic2 [];
uchar code pic3 [];

sbit RS = P0 ^ 7;
sbit WRD = P0 ^ 6;
sbit E = P0 ^ 5;
sbit PSB = P0 ^ 4;
sbit RES = P0 ^ 3;

void TransferData (char data1, bit DI);
void display (void);
void display_grapic (void);
void delayms (uint n);
void DisplayLine (uchar line1, uchar line2);
void DisplayGraphic (uchar code * adder);
void delay (uint m);
void lcd_mesg (uchar code * adder1);

uchar code IC_DAT [] = {
"QX-mini51"
"Original Direct Sales"
"SCM Development Board"
"QXMCU"
};

uchar code IC_DAT2 [] = {
"Moonlight in front of the bed," // 0x80
"Suspect frost on the ground," // 0x90
"Look up at the moon." // 0x88
"Head down to think about hometown." // 0x98
};

/ ************************************************* *******************
* Name: Convert (uchar In_Date)
* Function: Because the P0.0--P0.7 connection is exactly the opposite in the data during circuit design, this function is designed.
* Input: the value on 1602 data
* Output: the value sent to 1602
************************************************** ********************* /
unsigned char Convert (unsigned char In_Date)
{
    unsigned char i, Out_Date = 0, temp = 0;
    for (i = 0; i <8; i ++)
    {
        // temp = (In_Date >> i) & 0x01;
        // Out_Date | = (temp << (7-i));
                Out_Date = In_Date;

    }
    return Out_Date;
}

void initinal (void) // LCD font initialization program
{
           delay (40); // Delay program greater than 40MS
           PSB = 1; // Set to 8BIT parallel port working mode
           delay (1); // Delay
           RES = 0; // Reset
           delay (1); // Delay
           RES = 1; // The complex position is high
           delay (10);
           TransferData (0x30,0); // Extended Function Set: 8BIT setting, RE = 0: basic instruction set, G = 0: graphic display OFF
           delay (100); // Delay program greater than 100uS
           TransferData (0x30,0); // Function Set
           delay (37); //// Delay program greater than 37uS
           TransferData (0x08,0); // Display on Control
           delay (100); // Delay program greater than 100uS
           TransferData (0x10,0); // Cursor Display Control cursor setting
           delay (100); // Delay program greater than 100uS
           TransferData (0x0C, 0); // Display Control, D = 1, display on
           delay (100); // Delay program greater than 100uS
           TransferData (0x01,0); // Display Clear
           delay (10); // Delay program greater than 10mS
           TransferData (0x06,0); // Enry Mode Set, the cursor moves from right to left plus 1 bit
           delay (100); // Delay program greater than 100uS
          }

/ ************************************************* *******************
* Name: Main ()
* Function: Main function
* Input: None
* Output: None
************************************************** ********************* /
void initina2 (void) // LCD display picture (extended) initialization program
          {
           delay (40); // Delay program greater than 40MS
           PSB = 1; // Set to 8BIT parallel port working mode
           delay (1); // Delay
           RES = 0; // Reset
           delay (1); // Delay
           RES = 1; // The complex position is high
           delay (10);

           TransferData (0x36,0); // Extended Function Set RE = 1: extended instruction
           delay (100); // Delay program greater than 100uS
           TransferData (0x36,0); // Extended Function Set: RE = 1: extended instruction set
           delay (37); //// Delay program greater than 37uS
           TransferData (0x3E, 0); // EXFUNCTION (DL = 8BITS, RE = 1, G = 1)
           delay (100); // Delay program greater than 100uS
           TransferData (0x01,0); // CLEAR SCREEN
           delay (100); // Delay program greater than 100uS
          }

/ ************************************************* *******************
* Name: Main ()
* Function: Main function
* Input: None
* Output: None
************************************************** ********************* /
void main (void)
     {
         while (1)
            {
                  initina2 (); // Call the LCD display picture (extended) initialization program
  
          DisplayGraphic (pic2); // Display picture 2
          delayms (200);

          initinal (); // Call the LCD font initialization program
          delay (100); // Delay program greater than 100uS
          lcd_mesg (IC_DAT); // Display Chinese characters 1
          delayms (240);
          delayms (240);
          
          initinal (); // Call the LCD font initialization program
          delay (100); // Delay program greater than 100uS
          lcd_mesg (IC_DAT2); // Display Chinese characters 2
          delayms (240);
                  delayms (240);
                  initinal ();
        }
      }

/ ************************************************* *******************
* Name: Main ()
* Function: Main function
* Input: None
* Output: None
************************************************** ********************* /
void lcd_mesg (unsigned char code * adder1)
{
         unsigned char i;
         TransferData (0x80,0); // Set Graphic Display RAM Address
         delay (100);
         for (i = 0; i <32; i ++)
                 {
                         TransferData (* adder1,1);
                         adder1 ++;
                 }

         TransferData (0x90,0); // Set Graphic Display RAM Address
         delay (100);
         for (i = 32; i <64; i ++)
                 {
                         TransferData (* adder1,1);
                         adder1 ++;
                 }
}

/ ************************************************* *******************
* Name: Main ()
* Function: Main function
* Input: None
* Output: None
************************************************** ********************* /
void TransferData (char data1, bit DI) // Transfer data or command, when DI = 0, transfer command, when
DI = 1, transmit data.
           {
             WRD = 0;
             RS = DI;
             delay (1);
             P2 = Convert (data1);
             E = 1;
             delay (1);
             E = 0;
            }

/ ************************************************* *******************
* Name: Main ()
* Function: Main
* Input: None
* Output: None
************************************************** ********************* /
void delayms (unsigned int n) // Delay 10 × n millisecond program
                   {
                      unsigned int i, j;
                      for (i = 0; i <n; i ++)
                         for (j = 0; j <2000; j ++);
                   }

/ ************************************************* *******************
* Name: Main ()
* Function: Main function
* Input: None
* Output: None
************************************************** ********************* /
void delay (unsigned int m) // Delay procedure
                   {
                      unsigned int i, j;
                      for (i = 0; i <m; i ++)
                         for (j = 0; j <10; j ++);
                   }

/ ************************************************* *******************
* Name: Main ()
* Function: Main function
* Input: None
* Output: None
************************************************** ********************* /
void DisplayGraphic (unsigned char code * adder)
{

   int i, j;
// ******* Display the content of the first half of the screen
   for (i = 0; i <32; i ++) //
    {
      TransferData ((0x80 + i), 0); // SET vertical address VERTICAL ADD
      TransferData (0x80,0); // SET horizontal address HORIZONTAL ADD
      for (j = 0; j <16; j ++)
       {
         TransferData (* adder, 1);
         adder ++;
       }
    }
// ******* Display content settings for the second half of the screen
   for (i = 0; i <32; i ++) //
    {
      TransferData ((0x80 + i), 0); // SET vertical address VERTICAL ADD
      TransferData (0x88,0); // SET horizontal address HORIZONTAL ADD
      for (j = 0; j <16; j ++)
       {
         TransferData (* adder, 1);
         adder ++;
       }
    }
}


unsigned char code pic2[]=
{
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x78,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0x07,0x80,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xC0,0x01,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x00,0x00,0x78,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x00,0x00,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0x00,0x00,0x07,0x80,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x03,0xC0,0x00,0x00,0x01,0xC0,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x0F,0x00,0x00,0x00,0x00,0x70,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x3C,0x00,0x00,0x00,0x00,0x1C,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0xF0,0x00,0x00,0x00,0x00,0x1E,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x03,0xC0,0x00,0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x0F,0x00,0x00,0x00,0x00,0x01,0xE6,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x3C,0x00,0x00,0x00,0x00,0x07,0x82,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0xF0,0x00,0x00,0x00,0x00,0x1E,0x02,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0xE0,0x00,0x00,0x00,0x00,0x78,0x03,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0xE0,0x00,0x00,0x00,0x01,0xE0,0x03,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0x78,0x00,0x00,0x00,0x07,0x80,0x01,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x03,0x1E,0x00,0x00,0x00,0x1E,0x00,0x07,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x03,0x07,0x80,0x00,0x00,0x78,0x00,0x1F,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x02,0x01,0xE0,0x00,0x01,0xE0,0x00,0x3F,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x06,0x00,0x78,0x1F,0x07,0x80,0x01,0xF1,0x80,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x0E,0x00,0x1E,0x3F,0x9E,0x00,0x03,0xF9,0x80,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x0E,0x00,0x07,0xB3,0x78,0x00,0x0F,0xF9,0x80,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x0F,0x80,0x01,0xFF,0xE0,0x00,0x79,0x98,0x80,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x0F,0xE0,0x00,0x7F,0x80,0x00,0xE0,0xD8,0x80,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x0F,0xF8,0x00,0x0C,0x00,0x07,0xE0,0xF8,0x80,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x0E,0x7E,0x00,0x0C,0x00,0x1F,0xF0,0xF8,0x80,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x0E,0x1F,0x80,0x0C,0x00,0x7E,0x70,0xDC,0x80,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x0F,0x07,0xE0,0x0C,0x01,0xE3,0x70,0x5C,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x0F,0x81,0xF8,0x0C,0x07,0x83,0x70,0x5F,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x0D,0xE0,0x7E,0x0C,0x1F,0xC1,0xF0,0x5F,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x0F,0x78,0x3F,0x8C,0x7F,0xC1,0xB8,0x47,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x0F,0x1E,0x0F,0xED,0xEC,0xE1,0xB8,0xC7,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x1F,0x07,0x83,0xFF,0xC6,0xE1,0xB9,0xC7,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x1F,0x07,0xE0,0xFF,0xE7,0xE1,0xBF,0x07,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x1F,0x07,0xF8,0x3F,0xE7,0xE1,0xBF,0x07,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x1F,0x07,0x9E,0x0C,0xE6,0xE1,0x8F,0x07,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x1F,0x07,0x87,0x8C,0xE6,0xE3,0x8F,0x83,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x1F,0x0F,0x81,0xED,0xE6,0xE7,0x0F,0x83,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x1F,0x07,0x00,0x7F,0xE6,0xFE,0x0F,0x83,0x40,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x1F,0x00,0x00,0x1E,0x76,0xFE,0x0F,0x83,0x40,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x1E,0x00,0x00,0x00,0x72,0x1E,0x0F,0x83,0x40,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x1E,0x00,0x00,0x00,0x7E,0x1A,0x0F,0x83,0x40,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x1E,0x00,0x00,0x00,0x7C,0x1A,0x0F,0x83,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x0C,0x00,0x00,0x00,0x78,0x1A,0x0F,0x83,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x1A,0x07,0x83,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x1E,0x07,0x80,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x1F,0x07,0x80,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x1F,0x07,0x80,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x1F,0x07,0x80,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x1F,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x34,0x0C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x34,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x34,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

};
